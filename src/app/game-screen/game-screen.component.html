<div class="game-screen-container d-flex justify-content-center align-items-center vh-100">
    <div class="game-content d-flex flex-column align-items-center justify-content-start">

        <!-- Logo - hidden on mobile -->
        <img class="img-fluid mobile-hidden" style="width:200px" src="assets/pokel.png">

        <!-- Generation Selection Dropdown -->
        <div class="dropdown mb-2 mt-2" ngbDropdown #generationDropdown="ngbDropdown">
            <button class="btn btn-outline-primary dropdown-toggle" type="button" id="generationDropdown"
                ngbDropdownToggle>
                Generations ({{generations.length}} selected)
            </button>
            <ul class="dropdown-menu" ngbDropdownMenu aria-labelledby="generationDropdown">
                <li *ngFor="let gen of [1,2,3,4,5,6,7,8,9]">
                    <a class="dropdown-item d-flex align-items-center" href="#"
                        (click)="toggleGeneration($event, gen, generationDropdown)">
                        <span class="me-2">
                            <span [ngClass]="generations.includes(gen) ? 'text-success fw-bold' : 'text-muted'">
                                {{generations.includes(gen) ? 'âœ“' : 'â—‹'}}
                            </span>
                        </span>
                        Generation {{gen}}
                    </a>
                </li>
                <li>
                    <hr class="dropdown-divider">
                </li>
                <li>
                    <a class="dropdown-item text-primary" href="#" (click)="resetToGen1($event, generationDropdown)">
                        <i class="me-2">ðŸ”„</i>
                        Reset to Gen 1
                    </a>
                </li>
            </ul>
        </div>

        <!-- Selected Generations Display -->
        <div class="mb-5">
            <small class="text-muted">
                Generations: {{getSelectedGenerationsText()}}
            </small>
        </div>

        <!-- Mobile Action Buttons - positioned above letterboxes -->
        <div class="game-actions-mobile mb-5">
            <button class="btn btn-danger btn-xs" (click)="resetGame()">Play Again</button>
            <button class="btn btn-danger btn-xs" (click)="openHelpModal()">Help</button>
        </div>

        <!-- Letter Boxes -->
        <div class="letterboxes-container mb-3">
            <letterboxes #letterboxesComponent [guesses]="(guesses$ | async) || []" [guessNumber]="guessNumber"
                [gameOver]="gameOver" [hasFoundWord]="hasFoundWord"
                [focussedLetterIndex]="this.game.focussedLetterIndex" [evaluatingGuess]="evaluatingGuess"
                (focusLetterBox)="onFocusLetterBox($event)">
            </letterboxes>
        </div>

        <!-- Mobile Keyboard Container - positioned at bottom of content area -->
        <div class="keyboard-container-mobile">
            <keyboard class="pt-4" [guesses]="(guesses$ | async) || []" [evaluatingGuess]="evaluatingGuess"
                (validKeyPress)="onVirtualKeyboardKeyPress($event)">
            </keyboard>
        </div>

        <!-- Desktop Keyboard - hidden on mobile -->
        <div class="keyboard-container-desktop">
            <keyboard class="pt-4" [guesses]="(guesses$ | async) || []" [evaluatingGuess]="evaluatingGuess"
                (validKeyPress)="onVirtualKeyboardKeyPress($event)">
            </keyboard>
        </div>

        <!-- Game Status Messages -->
        <h4 *ngIf="hasFoundWord" class="mt-2">'Mon found! ðŸŽ‰</h4>
        <h4 class="mt-2" *ngIf="gameOver && hasFoundWord === false">{{targetNameString}}</h4>
        <!-- Desktop Action Buttons - hidden on mobile -->
        <div class="game-actions-desktop pt-4">
            <button class="btn btn-danger btn-lg me-2" (click)="resetGame()">Play Again</button>
            <button class="btn btn-outline-danger btn-sm" (click)="openHelpModal()">Help</button>
        </div>
    </div>
</div>

<!-- Help Modal Template -->
<ng-template #helpModal let-modal>
    <div class="modal-header">
        <h5 class="modal-title">How to Play Pokel</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
    </div>
    <div class="modal-body">
        <h6>Objective</h6>
        <p>Guess the PokÃ©mon name in as few attempts as possible!</p>

        <h6>How to Play</h6>
        <ul>
            <li>Type a PokÃ©mon name and press Enter to submit your guess</li>
            <li>You can type the name anywhere in the row - you don't need to fill every box. However, the target name
                will fill every box.</li>
            <li>The name must be a valid PokÃ©mon from one of your selected generations</li>
            <li>After each guess, you'll see color-coded feedback on each letter</li>
        </ul>

        <h6>Letter Feedback</h6>
        <ul>
            <li><strong class="text-success">Green Border:</strong> Letter is in the correct position</li>
            <li><strong class="text-warning">Yellow Border:</strong> Letter is in the word but wrong position</li>
            <li><strong class="text-secondary">Gray Border:</strong> Letter is not in the word</li>
        </ul>

        <h6>Controls</h6>
        <ul>
            <li><strong>Arrow Keys:</strong> Navigate between letter boxes</li>
            <li><strong>Backspace/Delete:</strong> Remove letters</li>
            <li><strong>Enter:</strong> Submit your guess</li>
            <li><strong>Tab:</strong> Move to next letter box</li>
        </ul>

        <h6>Generation Selection</h6>
        <p>Use the dropdown to select which PokÃ©mon generations to include in the game. You can select multiple
            generations or reset to just Generation 1.</p>

        <h6>Tips</h6>
        <ul>
            <li>You don't need to fill every box when making a guess - use this to narrow down your guesses or target
                specific letters</li>
            <li>Pay attention to the letter feedback to narrow down possibilities</li>
        </ul>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-danger" (click)="modal.close()">Got it!</button>
    </div>
</ng-template>